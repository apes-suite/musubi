<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="A multi-level parallel lattice Boltzmann solver within the APES suite.">
    <meta name="author" content="University of Siegen" >
    <link rel="icon" href="../../../favicon.png">

    <title>Abort Criteria &ndash; Musubi</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../../../css/fontawesome.min.css" rel="stylesheet">
    <link href="../../../css/brands.min.css" rel="stylesheet">
    <link href="../../../css/regular.min.css" rel="stylesheet">
    <link href="../../../css/solid.min.css" rel="stylesheet">
    <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../../../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../../../css/local.css" rel="stylesheet">
    <link href="../../../css/pygments.css" rel="stylesheet">
    <script src="../../../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../../../index.html">Musubi </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../../index.html">Documentation</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../../lists/types.html">Derived Types</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../../lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../../../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>Abort Criteria</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../../index.html'>Documentation</a></li>
                <li class="breadcrumb-item"><a href='../index.html'>Examples</a></li>
                <li class="breadcrumb-item"><a href='index.html'>Tutorials</a></li>
              <li class="breadcrumb-item active" aria-current="page">Abort Criteria</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="../../index.html">Documentation</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link" href="../../bibliography.html">Bibliography</a>
              <a class="nav-link" href="../index.html">Examples</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/index.html">Weakly compressible flows</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/application/index.html">Applications</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/application/Nonreflecting_BC/index.html">Nonreflecting Boundary Conditions</a>
              <a class="nav-link" href="../fluid/application/Nozzle/index.html">Nozzle</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/application/Nozzle/NOZ_FlowInAndAround/index.html">Nozzle flow inside an around</a>
              <a class="nav-link" href="../fluid/application/Nozzle/NOZ_FlowInside/index.html">Nozzle flow inside</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/index.html">Benchmarks</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/Channel2D/index.html">Channel 2D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/index.html">Channel 2D Boundary Conditions</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_MfrBB_PressExpol/index.html">Channel 2D MfrBB PressExpol</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_MfrEq_PressEq/index.html">Channel 2D MfrEq PressEq</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_PressExpol_PressExpol/index.html">Channel 2D PressExpol PressExpol</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_VelBB_PressExpol/index.html">Channel 2D VelBB PressExpol</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_VelBFL_PressExpol/index.html">Channel 2D VelBFL PressExpol</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_VelEq_PressEq/index.html">Channel 2D VelEq PressEq</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_BoundaryConditions/C2D_BC_VelNonEqExpol_PressNonEqExpol/index.html">Channel 2D VelNonEqExpol PressNonEqExpol</a>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/index.html">Poisueille flow in a channel 2D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_BGK/index.html">Poisueille flow in a channel 2D</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_drtBGK/index.html">Poisueille flow in a channel 2D</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_hrrBGK/index.html">Poisueille flow in a channel 2D</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_prrBGK/index.html">Poisueille flow in a channel 2D</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_rBGK/index.html">Poisueille flow in a channel 2D</a>
              <a class="nav-link" href="../fluid/benchmark/Channel2D/C2D_Simple/C2D_Simple_rrBGK/index.html">Poisueille flow in a channel 2D</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/Channel3D/index.html">Channel 3D test cases</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/Channel3D/C3D_Cylinder_MultiLevel_LES/index.html">Turbulent flow around the cylinder in a channel 3D at Re=3900</a>
              <a class="nav-link" href="../fluid/benchmark/Channel3D/C3D_Sphere_MultiLevel_LES/index.html">Turbulent flow around the sphere in a channel 3D</a>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/index.html">Turbulent channel</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/TC_SingleLevel/index.html">Turbulent channel wall model validation</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/TC_SingleLevel/TC_SL_MuskerFixedPoint/index.html">Turbulent channel wall model Musker</a>
              <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/TC_SingleLevel/TC_SL_MuskerNewton/index.html">Turbulent channel wall model Musker (Newton)</a>
              <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/TC_SingleLevel/TC_SL_PowerLaw/index.html">Turbulent channel wall model Power-Law</a>
              <a class="nav-link" href="../fluid/benchmark/TurbulentChannel/TC_SingleLevel/TC_SL_ReichardtFixedPoint/index.html">Turbulent channel wall model Reichardt</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/Vortex_convection/index.html">Convected vortex in a domain with a coarser grid at the center</a>
              <a class="nav-link" href="../fluid/benchmark/absorbingLayer/index.html">Absorbing layers</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticCylinder2D/index.html">Acoustic Line Source</a>
              <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticLineSource2D/index.html">Acoustic Line Source 2D</a>
              <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticPulse2D/index.html">Acoustic pulse 2D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticPulse2D/absLayerBox/index.html">Acoustic pulse 2D with absorbing layer box 2d</a>
              <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticPulse2D/absLayerPlane/index.html">Acoustic pulse 2D with absorbing layer plane</a>
              <a class="nav-link" href="../fluid/benchmark/absorbingLayer/acousticPulse2D/absLayerRadial/index.html">Acoustic pulse 2D with absorbing layer radial</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid/benchmark/gaussianPulse/index.html">Gaussian Pulse in Pressure in a Cube</a>
              <a class="nav-link" href="../fluid/benchmark/trackOutside/index.html">Tracking point outside the domain</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/index.html">Incompressible flows</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/application/index.html">Applications</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/index.html">Benchmarks</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/Channel2D/index.html">Channel 2D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/Channel2D/C2D_Cylinder_MultiLevel/index.html">Flow around the cylinder 2D single level</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Channel2D/C2D_Cylinder_SingleLevel/index.html">Flow around the cylinder 2D single level</a>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Channel3D/index.html">Channel 3D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/Channel3D/C3D_Simple/index.html">Simple Flow in a 3D Channel</a>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/ConcentricCylinders/index.html">Concentric Cylinders</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/ConcentricCylinders/COC_CoeutteFlow/index.html">Concentric Cylinders</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/ConcentricCylinders/COC_CoeutteFlow_MultiLevel/index.html">Concentric Cylinders</a>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/LidDrivenCavity/index.html">Lid driven cavity</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/LidDrivenCavity/LDC_MultiLevel/index.html">Lid driven cavity</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/LidDrivenCavity/LDC_Simple/index.html">Lid driven cavity</a>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/index.html">Pipe 3D</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/PIP_Force/index.html">Pipe Force</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/PIP_LES/index.html">Pipe LES</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/PIP_MultiLevel/index.html">Pipe 3D</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/PIP_Simple/index.html">Pipe Simple</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/Pipe/PIP_Split/index.html">Pipe Split</a>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/index.html">Taylor Green Vortex</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/TGV_LES/index.html">Taylor-Green Vortex with LES Turbulence Models at Re = 1600</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/TGV_LES/TGV_SmagGradU/index.html">Taylor-Green Vortex with WALE Smagorinsky (GradU) model at Re = 1600</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/TGV_LES/TGV_SmagPDF/index.html">Taylor-Green Vortex with WALE Smagorinsky (PDF) model at Re = 1600</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/TGV_LES/TGV_Vreman/index.html">Taylor-Green Vortex with Vreman LES model at Re = 1600</a>
              <a class="nav-link" href="../fluid_incompressible/benchmark/TaylorGreenVortex/TGV_LES/TGV_WALE/index.html">Taylor-Green Vortex with WALE LES model at Re = 1600</a>

                </nav>

                </nav>
              <a class="nav-link" href="../fluid_incompressible/benchmark/gaussianPulse/index.html">Gaussian Pulse in Pressure in a Cube</a>

                </nav>

                </nav>
              <a class="nav-link" href="../particles/index.html">Particulate Flows</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../particles/DPS/index.html">Unresolved Discrete Particle Simulation (DPS)</a>
              <a class="nav-link" href="../particles/MEM/index.html">Fully Resolved Model</a>

                </nav>
              <a class="nav-link" href="index.html">Tutorials</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="tut_00_prerequisites.html">Prerequisites</a>
              <a class="nav-link" href="tut_01_mus_config.html">Configuration</a>
              <a class="nav-link" href="tut_02_mus_toolchain.html">Toolchain</a>
              <a class="nav-link" href="tut_03_tracking.html">Tracking</a>
              <a class="nav-link" href="tut_04_boundaries.html">Boundary Conditions</a>
              <a class="nav-link" href="tut_05_restart.html">Restart</a>
              <a class="nav-link" href="tut_06_initial.html">Initial Conditions</a>
              <a class="nav-link active disabled" href="tut_07_convergence.html">Abort Criteria</a>
              <a class="nav-link" href="tut_08_source.html">Source Terms</a>
              <a class="nav-link" href="tut_09_mus_multilevel.html">Multilevel Simulations</a>
              <a class="nav-link" href="tut_10_Musubi2.html">Prerequisites</a>

                </nav>

                </nav>
              <a class="nav-link" href="../../features/index.html">Feature Overview</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../../features/comp_proc.html">Description of the Multi-Level Algorithm</a>
              <a class="nav-link" href="../../features/data_struc.html">Data Structures</a>
              <a class="nav-link" href="../../features/intp_methods.html">Interpolation Methods</a>
              <a class="nav-link" href="../../features/multispecies.html">Multispecies</a>
              <a class="nav-link" href="../../features/mus_hvs_scheme_impl.html">Musubi-Harvesting</a>
              <a class="nav-link" href="../../features/mus_nonNewtonianTheory.html">Non-Newtonian Fluid Simulations</a>
              <a class="nav-link" href="../../features/mus_vectorization.html">Vectorization</a>
              <a class="nav-link" href="../../features/scheme.html">Scheme Implementation</a>

                </nav>
              <a class="nav-link" href="../../usage/index.html">Build and run Musubi</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <div class="alert alert-warning">
<p class="alert-title h4">Warning</p>
<p>WORK IN PROGRESS</p>
</div>
<p>Navigate: <a href="tut_06_initial.html">&larr; Initial Conditions</a>
| <a href="index.html">Overview</a>
| <a href="tut_08_source.html">Source Terms &rarr;</a></p>
<h1 id="abort-criteria">Abort Criteria</h1>
<p>In this tutorial, we show how to use a convergence criterium to
stop the code before reaching the maximum time.
Convergence sensors are actually objects part of the <code>sim_control</code> table with
an additional <code>abort_criteria</code> table.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">sim_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">time_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nv">abort_criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="nv">convergence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">variable</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">{...},</span>
<span class="w">      </span><span class="nv">shape</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">{...},</span>
<span class="w">      </span><span class="nv">time_control</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{...},</span>
<span class="w">      </span><span class="nv">reduction</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">{...},</span>
<span class="w">      </span><span class="nv">norm</span><span class="w">          </span><span class="o">=</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;simple&#39; or &#39;average&#39;</span>
<span class="w">      </span><span class="nv">nvals</span><span class="w">         </span><span class="o">=</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="p">,</span>
<span class="w">      </span><span class="nv">absolute</span><span class="w">      </span><span class="o">=</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;true&#39; or &#39;false&#39;</span>
<span class="w">      </span><span class="nv">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">{...},</span><span class="w"> </span><span class="c1">-- nConditions == nVariables</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>See <a href="https://apes-suite.github.io/treelm/proc/tem_convergence_load.html">tem_convergence_load</a> for a set of options and few examples.</p>
</div>
<p>Let's consider the channel test case of before again.
If we now want to add a convergence sensor to the simulation, we add the table
<code>abort_criteria</code> to <code>sim_control</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">--! [Simulation Control]</span>
<span class="nv">sim_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">time_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tmax_phy</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nv">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">interval_phy</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nv">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="c1">--s</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">  </span><span class="c1">-- Abort conditions for simulation</span>
<span class="w">  </span><span class="nv">abort_criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">-- Abort if file with the name &#39;stop&#39; exist</span>
<span class="w">    </span><span class="nv">stop_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;stop&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="c1">-- Abort if steady state is reached with condition defined in convergence</span>
<span class="w">    </span><span class="c1">-- table</span>
<span class="w">    </span><span class="nv">steady_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="c1">-- Convergence condition for steady state check</span>
<span class="w">    </span><span class="nv">convergence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">-- Variables to check</span>
<span class="w">      </span><span class="nv">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;pressure_phy&#39;</span><span class="p">},</span>
<span class="w">      </span><span class="c1">-- Check only point in middle of domain</span>
<span class="w">      </span><span class="nv">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;canoND&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nv">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="nv">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">}</span><span class="w"> </span><span class="p">}}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="c1">-- Reduce variables values in space to single average value</span>
<span class="w">      </span><span class="nv">reduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;average&#39;</span><span class="p">},</span>
<span class="w">      </span><span class="c1">-- How often to do convergence?</span>
<span class="w">      </span><span class="nv">time_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tmax_phy</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Start convergence check after half sim. time</span>
<span class="w">        </span><span class="nv">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tmax_phy</span><span class="p">,</span><span class="w">      </span><span class="c1">-- DO convergence until end of simulation</span>
<span class="w">        </span><span class="nv">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="nv">dt</span><span class="w">     </span><span class="c1">-- Do convernce check every 10*dt [s]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nv">norm</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nv">nvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nv">absolute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="c1">-- Condition to statisfy to every variable</span>
<span class="w">      </span><span class="nv">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nv">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.e-5</span><span class="p">,</span><span class="w"> </span><span class="nv">operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;=&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">--! [Simulation control]</span>
</code></pre></div>

<p>In the convergence table you now specify under which condition a simulation is
converged. We already chose the quantity to use as the pressure above. The norm
to evaluate the convergence defines how to compute the converged condition on a
set of available data. The length of this set is defined by <code>nvals</code>. This
basically means over how many points in time the convergence is evaluated.
The condition under which convergence is achieved is done with the <code>condition</code>
table. You specify a threshold and the operator. You can choose if you want an
<code>absolute</code> or a <code>relative</code> metric by specifying <code>absolute = true / false</code>.</p>
<p>Each point in time when this object is active (i.e. the conditions of the time
definition table are met), a value is added to the convergence data set. The
current convergence quantity is then compared to the norm of the convergence
data set. If the condition is met, convergence is achieved.</p>
<blockquote>
<p>See residual is evaluated within <a href="https://apes-suite.github.io/treelm/proc/tem_convergence_evaluate.html">tem_convergence_evaluate</a>
with function <a href="https://apes-suite.github.io/treelm/proc/evaluate_residual.html">evaluate_residual</a>.</p>
</blockquote>
<p>In our case, the current pressure value is compared to the average over fifty
points in time. If the difference is smaller or equal to 1.e-5, the convergence
is set to be achieved.</p>
<p>Once convergence is achieved, this is communicated to all other processes in
the next interval, when the total density is computed.  Then, the simulation is
terminated after writing out all tracking, restart and output data.</p>
<h2 id="automatic-and-manual-stopping-of-musubi">Automatic and Manual Stopping of Musubi</h2>
<p>The code might have to stop in other cases. One case is when invalid numbers
are encountered. When the total density within the simulation domain is
computed, <em>Musubi</em> checks if invalid numbers are found. If so, the result is
invalid, as the code has just been crashing, and the simulation can be stopped.
Nevertheless, all tracking and restart files are written.</p>
<p>Sometimes computing resources are restricted to a certain time interval only.
It should therefore be ensured that <em>Musubi</em> terminates cleanly upon reaching
such a time limit. You can define maximum wall clock limits, upon which
<em>Musubi</em> then stops. In the time object, you just have to give the maximum
number of seconds as:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">sim_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">time_control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tEnd</span><span class="p">,</span>
<span class="w">    </span><span class="nv">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">interval</span><span class="p">,</span>
<span class="w">    </span><span class="nv">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="c1">--s</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nv">abort_criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>If you manually want to terminate <em>Musubi</em>, you can create a file in the musubi
directory during runtime. It must be named <code>stop</code> and does not have to have any
content. Upon next check interval, <em>Musubi</em> checks for the existence of the
file. If encountered, <em>Musubi</em> terminates cleanly.</p>
<p>Next chapter: <a href="tut_08_source.html">Source Terms &rarr;</a></p>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              Musubi
 was developed by University of Siegen<br>              &copy; 2025 
<br /><small>d01bb484473c</small></p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-04-24T09:44:22.475563+0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>